datasource db {
    provider = "postgresql"
    url = env("DATABASE_URL")
}
generator client {
  provider = "prisma-client-js"
  output   = "generated/prisma"
}

model User {
    id Int @id @default(autoincrement())
    discord_id String @unique
    created_at DateTime @default(now())
    updated_at DateTime?

    checkin_streaks CheckinStreak[]
    checkins Checkin[]
}

model CheckinStreak {
  id Int @id @default(autoincrement())
  user_id Int
  first_date DateTime @default(now())
  last_date DateTime?
  streak Int @default(0)
  updated_at DateTime?

  user User @relation(fields: [user_id], references: [id])
  checkins Checkin[]

  @@index([user_id, first_date(sort: Desc)])
}

model Checkin {
    id Int @id @default(autoincrement())
    public_id String @unique
    user_id Int
    checkin_streak_id Int
    description String
    link String?
    status String
    reviewed_by String?
    created_at DateTime @default(now())
    updated_at DateTime?

    user User @relation(fields: [user_id], references: [id])
    checkin_streak CheckinStreak @relation(fields: [checkin_streak_id], references: [id])

    @@index([user_id, created_at(sort: Desc)])
}

model Attachment {
  id Int @id @default(autoincrement())
  name String @default("")
  url String @default("")
  type String @default("")
  size Int @default(0)
  created_at DateTime @default(now())
  module_id Int
  module_type String

  @@index([module_id, module_type, created_at(sort: Desc)])
}